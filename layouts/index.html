{{ define "main" }}
<section class="hero-section">
    <div class="hero-image">
        <picture>
            <source srcset="/hero.webp" type="image/webp">
            <img src="/hero.jpg" alt="Pedro AlcÃ cer">
        </picture>
    </div>
</section>

<!-- NEWS Window -->
{{ $newsData := .Site.Data.news }}
{{ if $newsData }}
{{ $latestNews := index $newsData 0 }}
{{ if $latestNews }}
{{ $currentLang := .Language.Lang }}
{{ $newsContent := index $latestNews.content $currentLang }}
{{ if $newsContent }}
<section class="news-window-section">
    <div class="container">
        <div class="news-window">
            <div class="news-header">
                <span class="news-icon">ðŸ“¢</span>
                <h3 class="news-title">NEWS</h3>
            </div>
            <div class="news-content">
                {{ $newsContent | safeHTML }}
            </div>
            {{ if $latestNews.date }}
            <div class="news-date">{{ dateFormat "02 Jan 2006" $latestNews.date }}</div>
            {{ end }}
        </div>
    </div>
</section>
{{ end }}
{{ end }}
{{ end }}

<!-- Quote removed from top; rendered as a normal bottom section below -->

<!-- CTA removed: streaming link is now the caption under the Bandcamp player -->

<section class="bandcamp-section">
    <div class="container">
        <div class="bc-and-calendar">
            <div class="bc-player">
                <iframe class="bc-iframe" style="border: 0;"
                    src="https://bandcamp.com/EmbeddedPlayer/album=236862947/size=large/bgcol=ffffff/linkcol=0687f5/tracklist=false/transparent=true/"
                    seamless><a
                        href="https://palcacer.bandcamp.com/album/luis-mil-n-primer-libro-intitulado-el-maestro">Luis
                        MilÃ¡n - Primer libro intitulado &quot;El Maestro&quot; by Pedro Alcacer - Vihuela</a></iframe>
                <h2 class="bc-caption"><a href="{{ " discs/luis-milan/" | relLangURL }}">{{ i18n "hero_title" }}</a>
                </h2>
            </div>

            <div class="bc-calendar">
                <h3 class="calendar-title">Next concerts</h3>
                {{ $events := .Site.Data.calendar_events }}
                {{ if $events }}
                {{ $list := index $events 0 }}
                {{ if gt (len $events) 0 }}
                <div class="gc-list-container" tabindex="0" aria-label="Upcoming concerts">
                    <ul class="gc-list">
                        {{ range $events }}
                        <li class="gc-item">
                            {{ $s := .start_iso }}
                            {{ $t := time $s }}
                            <details>
                                <summary>
                                    <div class="gc-summary-left">
                                        <span class="gc-title-text">{{ .title }}</span>
                                        {{ if .location }}<span class="gc-location">{{ .location }}</span>{{ end }}
                                    </div>
                                    <div class="gc-summary-date">
                                        <span class="gc-date-line1">{{ dateFormat "Mon, 02 Jan 2006" $t }}</span>
                                        <span class="gc-date-line2">{{ dateFormat "15:04" $t }}</span>
                                    </div>
                                </summary>
                            </details>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                {{ else }}
                <div class="gc-empty">No upcoming concerts.</div>
                {{ end }}
                {{ else }}
                <!-- If no build-time data, include a client widget that can call a serverless endpoint or Google API -->
                {{ $cal := .Site.Params.googleCalendar }}
                {{ if $cal }}
                <div id="google-calendar-widget" data-calendar-id="{{ $cal.calendarId }}"
                    data-api-key="{{ $cal.apiKey }}" {{ if $cal.endpoint }}data-endpoint="{{ $cal.endpoint }}" {{ end
                    }}></div>
                <script src="/js/google-calendar-widget.js?v=RESTORED3" defer></script>
                {{ else }}
                <div class="gc-loading">Calendar not configured.</div>
                {{ end }}
                {{ end }}
            </div>
        </div>
    </div>
</section>

<section class="newsletter-section">
    <div class="container">
        <h3>{{ i18n "newsletter_heading" }}</h3>
        <form class="newsletter-form" action="https://formspree.io/f/mbdlnanv" method="POST">
            <input type="email" name="email" placeholder="Enter your email" required>
            <input type="hidden" name="_subject" value="New newsletter subscription">
            <input type="hidden" name="_next" value="{{ .Site.BaseURL }}">
            <button type="submit">Subscribe</button>
        </form>
    </div>
</section>

<!-- Normal bottom quote section -->
<section class="quote-section" aria-label="Testimonial">
    <div class="container">
        <blockquote class="testimonial">
            <p>{{ i18n "quote_text" }}</p>
            <footer>
                <strong>{{ i18n "quote_author" }}</strong><br>
                {{ i18n "quote_role" }}
            </footer>
        </blockquote>
    </div>
</section>
{{ end }}