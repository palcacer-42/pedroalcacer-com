{{ define "main" }}
<section class="programs-section" aria-labelledby="programs-heading">
    <div class="programs-wrapper elegant">
    <h1 id="programs-heading" class="programs-title">{{ .Title }}</h1>

    <div class="program-jumps" aria-hidden="false">
      <a href="#solo">Solo</a>
      <span class="dot">Â·</span>
      <a href="#ensemble">Ensemble</a>
    </div>

    

    {{/* If no group metadata exists, render a single 'All programmes' reduced list */}}
    {{ $soloRaw := where .Pages "Params.group" "Solo" }}
    {{ $solo := where (where $soloRaw "File.BaseFileName" "ne" "solo") "File.BaseFileName" "ne" "ensemble" }}
    {{ $ensRaw := where .Pages "Params.group" "Ensemble" }}
    {{ $ens := where (where $ensRaw "File.BaseFileName" "ne" "solo") "File.BaseFileName" "ne" "ensemble" }}
    {{ $hasGroups := or (gt (len $solo) 0) (gt (len $ens) 0) }}

    {{ if $hasGroups }}
      <h2 id="solo" class="programs-section-heading">Solo programmes</h2>
      <ul class="program-list reduced-list">
        {{ range $solo }}
          {{ $p := . }}
          <li class="program-item reduced">
            {{ with $p.Params.image }}<div class="program-thumb"><img src="{{ . | relURL }}" alt="{{ $p.Title }}"></div>{{ end }}
            <div class="program-meta">
              {{ if $p.Params.shortinfo }}
                <div class="program-info">{{ $p.Params.shortinfo }}</div>
              {{ else if $p.Params.description }}
                <div class="program-info">{{ $p.Params.description | plainify | truncate 90 }}</div>
              {{ end }}
              <a class="program-name" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
              {{ with $p.Params.musicians }}
                {{ $first := first 3 . }}
                <div class="program-musicians">{{ delimit $first ", " }}{{ if gt (len .) 3 }} â€¦{{ end }}</div>
              {{ end }}
              {{ with $p.Params.subtitle }}<div class="program-subtitle">{{ . }}</div>{{ end }}
            </div>
            <div class="program-download">
              {{ if $p.Params.pdf }}
                <a class="pdf-cta small" href="{{ $p.Params.pdf }}" aria-label="Download PDF for {{ $p.Title }}">
                  <i class="fas fa-file-pdf" aria-hidden="true"></i><span class="sr-only">Download PDF</span>
                </a>
              {{ else }}
                <a class="programme-link small" href="{{ $p.RelPermalink }}" aria-label="Open programme for {{ $p.Title }}">
                  <i class="fas fa-file-lines" aria-hidden="true"></i><span class="sr-only">Open programme</span>
                </a>
              {{ end }}
            </div>
          </li>
        {{ end }}
      </ul>

      <h2 id="ensemble" class="programs-section-heading">Ensemble programmes</h2>
      <ul class="program-list reduced-list">
        {{ range $ens }}
          {{ $p := . }}
          <li class="program-item reduced">
            {{ with $p.Params.image }}<div class="program-thumb"><img src="{{ . | relURL }}" alt="{{ $p.Title }}"></div>{{ end }}
            <div class="program-meta">
              {{ if $p.Params.shortinfo }}
                <div class="program-info">{{ $p.Params.shortinfo }}</div>
              {{ else if $p.Params.description }}
                <div class="program-info">{{ $p.Params.description | plainify | truncate 90 }}</div>
              {{ end }}
              <a class="program-name" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
              {{ with $p.Params.musicians }}
                {{ $first := first 3 . }}
                <div class="program-musicians">{{ delimit $first ", " }}{{ if gt (len .) 3 }} â€¦{{ end }}</div>
              {{ end }}
              {{ with $p.Params.subtitle }}<div class="program-subtitle">{{ . }}</div>{{ end }}
            </div>
            <div class="program-download">
              {{ if $p.Params.pdf }}
                <a class="pdf-cta small" href="{{ $p.Params.pdf }}" aria-label="Download PDF for {{ $p.Title }}">
                  <i class="fas fa-file-pdf" aria-hidden="true"></i><span class="sr-only">Download PDF</span>
                </a>
              {{ else }}
                <a class="programme-link small" href="{{ $p.RelPermalink }}" aria-label="Open programme for {{ $p.Title }}">
                  <i class="fas fa-file-lines" aria-hidden="true"></i><span class="sr-only">Open programme</span>
                </a>
              {{ end }}
            </div>
          </li>
        {{ end }}
      </ul>

      {{ $others := where .Pages "Params.group" "" }}
        {{ if gt (len $others) 0 }}
        <h2 class="programs-section-heading">Other programmes</h2>
        <ul class="program-list reduced-list">
          {{ range $others }}
            {{ $p := . }}
            <li class="program-item reduced">
              {{ with $p.Params.image }}<div class="program-thumb"><img src="{{ . | relURL }}" alt="{{ $p.Title }}"></div>{{ end }}
              <div class="program-meta">
                {{ if $p.Params.shortinfo }}
                  <div class="program-info">{{ $p.Params.shortinfo }}</div>
                {{ else if $p.Params.description }}
                  <div class="program-info">{{ $p.Params.description | plainify | truncate 90 }}</div>
                {{ end }}
                <a class="program-name" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
                {{ with $p.Params.musicians }}
                  {{ $first := first 3 . }}
                  <div class="program-musicians">{{ delimit $first ", " }}{{ if gt (len .) 3 }} â€¦{{ end }}</div>
                {{ end }}
                {{ with $p.Params.subtitle }}<div class="program-subtitle">{{ . }}</div>{{ end }}
              </div>
              <div class="program-download">
                <a class="programme-link small" href="{{ $p.RelPermalink }}" aria-label="Open programme for {{ $p.Title }}"><i class="fas fa-file-lines" aria-hidden="true"></i><span class="sr-only">Open programme</span></a>
                {{ with $p.Params.pdf }}<a class="pdf-cta small" href="{{ . }}" aria-label="Download for {{ $p.Title }}"><i class="fas fa-file-pdf" aria-hidden="true"></i><span class="sr-only">Download PDF</span></a>{{ end }}
              </div>
            </li>
          {{ end }}
        </ul>
      {{ end }}

    {{ else }}
      <h2 class="programs-section-heading">All programmes</h2>
      <ul class="program-list reduced-list">
        {{ range .Pages.ByTitle }}
          {{ $p := . }}
          <li class="program-item reduced">
            {{ with $p.Params.image }}<div class="program-thumb"><img src="{{ . | relURL }}" alt="{{ $p.Title }}"></div>{{ end }}
            <div class="program-meta">
              {{ if $p.Params.shortinfo }}
                <div class="program-info">{{ $p.Params.shortinfo }}</div>
              {{ else if $p.Params.description }}
                <div class="program-info">{{ $p.Params.description | plainify | truncate 90 }}</div>
              {{ end }}
              <a class="program-name" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
              {{ with $p.Params.subtitle }}<div class="program-subtitle">{{ . }}</div>{{ end }}
            </div>
            <div class="program-download">
              {{ if $p.Params.pdf }}
                <a class="pdf-cta small" href="{{ $p.Params.pdf }}" aria-label="Download PDF for {{ $p.Title }}">
                  <i class="fas fa-file-pdf" aria-hidden="true"></i><span class="sr-only">Download PDF</span>
                </a>
              {{ else }}
                <a class="programme-link small" href="{{ $p.RelPermalink }}" aria-label="Open programme for {{ $p.Title }}">
                  <i class="fas fa-file-lines" aria-hidden="true"></i><span class="sr-only">Open programme</span>
                </a>
              {{ end }}
            </div>
          </li>
        {{ end }}
      </ul>
    {{ end }}

    {{/* leftover pages not assigned to Solo/Ensemble */}}
    {{ $others := where .Pages "Params.group" "" }}
    {{ if gt (len $others) 0 }}
      <h2 class="programs-section-heading">Other programmes</h2>
      <ul class="program-list reduced-list">
        {{ range $others }}
          {{ $p := . }}
          <li class="program-item reduced">
            {{ with $p.Params.image }}<div class="program-thumb"><img src="{{ . | relURL }}" alt="{{ $p.Title }}"></div>{{ end }}
            <div class="program-meta">
              <a class="program-name" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
              {{ with $p.Params.subtitle }}<div class="program-subtitle">{{ . }}</div>{{ end }}
            </div>
            {{ with $p.Params.pdf }}<div class="program-download"><a class="pdf-cta small" href="{{ . }}" aria-label="Download for {{ $p.Title }}">ðŸ“„</a></div>{{ end }}
          </li>
        {{ end }}
      </ul>
    {{ end }}

  </div>
  <div class="programs-help">For booking information and program details, please visit the Contact page.</div>
</section>

<style>
  :root{
    --prog-max-width:820px;
    --accent:#0b4a7a;
    --accent-soft:#eaf4fb;
    --muted:#6b6b6b;
    --card-bg:#fbfdff;
  }

  .programs-section{
    max-width:var(--prog-max-width);
    margin:40px auto;
    padding:30px 20px;
    font-family: Inter, system-ui, -apple-system, "Helvetica Neue", Arial;
    color:#111;
    background:#fff;
  }

  .programs-wrapper.elegant{padding:0}

  .programs-title{
    font-family: "Merriweather", Georgia, serif;
    font-size:2.6rem;
    line-height:1.06;
    margin:0 0 12px;
    color:var(--accent);
    letter-spacing:0.2px;
  }

  .program-jumps{margin:8px 0 14px}
  .program-jumps a{color:var(--accent);font-weight:700;text-decoration:none;margin-right:8px}
  .program-jumps .dot{color:var(--muted);margin:0 6px}

  .programs-intro{
    font-size:1.02rem;
    line-height:1.6;
    color:var(--muted);
    margin-bottom:18px;
    max-width:68ch;
  }

  .pdf-icon{display:inline-block;margin-right:8px;font-size:1.05rem;color:var(--accent);vertical-align:middle}
  .program-info{font-size:0.98rem;color:#34586b;margin-right:10px;max-width:46ch;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .program-musicians{font-size:0.95rem;color:#2f5060;margin-top:6px;line-height:1.3}
  .programme-link.small{display:inline-block;margin-right:8px;padding:6px 10px;border-radius:8px;background:transparent;border:1px solid rgba(11,74,122,0.06);color:var(--accent);text-decoration:none;font-weight:700}
  .programme-link.small:hover{background:var(--accent-soft)}
  .programme-link.small i, .pdf-cta.small i{font-size:1.02rem;vertical-align:middle}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  .single-list{list-style:none;padding:0;margin:0}

  .program-item{
    padding:20px 18px;
    border-radius:12px;
    background:var(--card-bg);
    border:1px solid #eef4f9;
    margin-bottom:18px;
    box-shadow:0 6px 18px rgba(11,34,56,0.04);
    transition:transform .12s ease,box-shadow .12s ease;
  }

  .program-item:hover{transform:translateY(-4px);box-shadow:0 14px 30px rgba(11,34,56,0.08)}

  .program-name{
    display:block;
    font-size:1.25rem;
    font-weight:700;
    color:#073a59;
    text-decoration:none;
    margin-bottom:6px;
  }

  .program-thumb{margin-bottom:12px}
  .program-thumb img{width:100%;max-width:180px;height:110px;object-fit:cover;border-radius:6px;display:block}

  /* Reduced list styles */
  .reduced-list{list-style:none;padding:0;margin:0 0 18px}
  .program-item.reduced{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(0,0,0,0.03);margin-bottom:10px}
  .program-item.reduced .program-thumb{flex:0 0 180px}
  .program-item.reduced .program-meta{flex:1}
  .program-item.reduced .program-excerpt{font-size:0.95rem;color:#333;line-height:1.5;margin:6px 0 0}
  .pdf-cta.small{padding:8px 10px;border-radius:8px;font-size:0.95rem}

  @media(min-width:740px){
    .program-item.reduced{padding:14px 16px}
    .program-thumb img{width:100%;max-width:200px;height:120px}
  }

  @media(max-width:739px){
    .program-item.reduced{flex-direction:column;align-items:flex-start}
    .program-thumb{width:100%;max-width:100%}
    .program-thumb img{height:auto;max-width:360px}
  }

  .program-name:focus,.program-name:hover{text-decoration:underline}

  .program-subtitle{font-size:1rem;color:#34485a;margin-bottom:8px}

  .program-excerpt{font-size:1.03rem;color:#222;line-height:1.8;margin-bottom:12px;max-width:75ch}

  .program-download{margin-top:6px}

  .pdf-cta{
    display:inline-flex;align-items:center;gap:.6rem;padding:10px 16px;background:var(--accent);color:#fff;border-radius:10px;text-decoration:none;font-weight:700;box-shadow:0 6px 18px rgba(11,34,56,0.06)
  }

  .pdf-cta:hover,.pdf-cta:focus{background:#083a63}

  .programs-help{margin-top:18px;font-size:0.98rem;color:var(--muted)}

  @media(min-width:880px){.programs-section{padding:34px 28px}}
</style>
{{ end }}
