{{ define "main" }}
<section class="page-hero">
  <div class="hero-image">
    <picture>
      <source srcset="{{ "/images/discs-hero.webp" | relURL }}" type="image/webp">
      <img src="{{ "/images/discs-hero.jpg" | relURL }}" alt="{{ .Title }}" class="hero-image"
        style="object-position: bottom;">
    </picture>
  </div>
</section>
<section class="page-content section-with-gradient">
  <div class="container">
    <div class="elegant-card">
      <h1>{{ .Title }}</h1>
      {{ if .Description }}
      <p class="post-body">{{ .Description }}</p>
      {{ end }}
    </div>

    <div class="media-grid">
      {{ range .Params.media }}
      <div class="media-card">
        {{ $prov := .provider }}
        {{ $vid := .video_id }}
        <div class="media-video-container">
          {{ if and $prov $vid }}
          {{ if eq $prov "youtube" }}
          {{ $startParam := "" }}{{ if .start }}{{ $startParam = printf "?start=%s" .start }}{{ end }}
          <iframe src="https://www.youtube-nocookie.com/embed/{{ $vid }}{{ $startParam }}" frameborder="0"
            loading="lazy" title="Video: {{ .title }}"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
          {{ else if eq $prov "vimeo" }}
          <iframe src="https://player.vimeo.com/video/{{ $vid }}" frameborder="0" loading="lazy"
            title="Video: {{ .title }}" allowfullscreen></iframe>
          {{ end }}
          {{ else if .video_url }}
          {{ $url := .video_url }}
          {{ if or (strings.Contains $url "youtube.com") (strings.Contains $url "youtu.be") }}
          {{ $id := replaceRE ".*(?:v=|be/)([^&?/]+).*" "$1" $url }}
          <iframe src="https://www.youtube-nocookie.com/embed/{{ $id }}" frameborder="0" loading="lazy"
            title="Video: {{ .title }}"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
          {{ else if strings.Contains $url "vimeo.com" }}
          {{ $id := replaceRE ".*(?:video/|vimeo.com/)([^&?/]+).*" "$1" $url }}
          <iframe src="https://player.vimeo.com/video/{{ $id }}" frameborder="0" loading="lazy"
            title="Video: {{ .title }}" allowfullscreen></iframe>
          {{ end }}
          {{ else }}
          <div class="video-placeholder">Video coming soon</div>
          {{ end }}
        </div>

        <div class="media-info">
          <h3 class="media-title">{{ .title }}</h3>
          <p class="media-artist">{{ .artist }}</p>

          {{ if and $prov $vid }}
          {{ if eq $prov "youtube" }}
          <a href="https://www.youtube.com/watch?v={{ $vid }}" target="_blank" rel="noopener"
            class="media-link-small"><i class="fab fa-youtube"></i> Watch on YouTube</a>
          {{ else if eq $prov "vimeo" }}
          <a href="https://vimeo.com/{{ $vid }}" target="_blank" rel="noopener" class="media-link-small"><i
              class="fab fa-vimeo-v"></i> Watch on Vimeo</a>
          {{ end }}
          {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}