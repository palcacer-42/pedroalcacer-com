{{ define "main" }}
<section class="page-hero">
    <img src="{{ "/images/media-hero.jpg" | relURL }}" alt="{{ .Title }}" class="hero-image">
</section>
<section class="page-content">
    <div class="container">
        <h1>{{ .Title }}</h1>
        {{ if .Content }}
        <div class="post-body">
            {{ .Content }}
        </div>
        {{ end }}
        
        <div class="media-grid">
            {{ range .Params.media }}
            <div class="media-item">
                {{ $prov := .provider }}
                {{ $vid := .video_id }}
                {{ if and $prov $vid }}
                    {{ if eq $prov "youtube" }}
                        <iframe 
                            src="https://www.youtube.com/embed/{{ $vid }}" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                        <p class="video-link"><a href="https://www.youtube.com/watch?v={{ $vid }}" target="_blank" rel="noopener">Watch on YouTube</a></p>
                    {{ else if eq $prov "vimeo" }}
                        <iframe src="https://player.vimeo.com/video/{{ $vid }}" frameborder="0" allowfullscreen></iframe>
                        <p class="video-link"><a href="https://vimeo.com/{{ $vid }}" target="_blank" rel="noopener">Watch on Vimeo</a></p>
                    {{ end }}
                {{ else if .video_url }}
                    {{ $url := .video_url }}
                    {{ if or (strings.Contains $url "youtube.com") (strings.Contains $url "youtu.be") }}
                        {{ $id := replaceRE ".*(?:v=|be/)([^&?/]+).*" "$1" $url }}
                        <iframe 
                            src="https://www.youtube.com/embed/{{ $id }}" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                        <p class="video-link"><a href="{{ $url }}" target="_blank" rel="noopener">Watch on YouTube</a></p>
                    {{ else if strings.Contains $url "vimeo.com" }}
                        {{ $id := replaceRE ".*(?:video/|vimeo.com/)([^&?/]+).*" "$1" $url }}
                        <iframe src="https://player.vimeo.com/video/{{ $id }}" frameborder="0" allowfullscreen></iframe>
                        <p class="video-link"><a href="{{ $url }}" target="_blank" rel="noopener">Watch on Vimeo</a></p>
                    {{ end }}
                {{ end }}
                <div class="media-info">
                    <h3>{{ .title }}</h3>
                    <p>{{ .artist }}</p>
                </div>
            </div>
            {{ end }}
        </div>
    </div>
</section>
{{ end }}
